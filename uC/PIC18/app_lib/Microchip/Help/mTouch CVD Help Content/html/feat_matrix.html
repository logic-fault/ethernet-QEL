<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>mTouch Framework: Matrix Designs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.2 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="navpath">
    <ul>
      <li><a class="el" href="main.html">main</a>      </li>
      <li><a class="el" href="_framework_features.html">Features</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>Matrix Designs </h1>  </div>
</div>
<div class="contents">
<p>The mTouch Framework supports decoding of matrix'd sensors to simplify the user's design process. This method allows for a larger number of possible unique press locations by decoding the state of two sensors at once: the row and the column.</p>
<h2><a class="anchor" id="featMatrix-How"></a>
How It Works</h2>
<p>The mTouch Framework will scan all sensors as normal. When a new set of readings is available, the framework will first perform some logic to determine which row and which column is the most pressed of the matrix. If both a row and column are activated, the state machine for the sensors will begin debouncing the result. After the required number of repeated results, the matrix coordinate-output will be updated.</p>
<div align="center">
<img src="matrix.JPG" alt="matrix.JPG"/>
<p><strong>Sensors in a Matrix Configuration</strong></p></div>
 <h2><a class="anchor" id="featMatrix-Config"></a>
Proximity Sensor Configuration</h2>
<ol>
<li>
Configure the matrix'd sensors to be scanned as normal sensors in the <a class="el" href="m_touch__config_8h.html" title="Framework Configuration! Main configuration file for the mTouch Framework.">mTouch_config.h</a> file. We will be defining index ranges for the rows and columns, so when configuring the MTOUCH_SENSORx list, make sure to place the matrix sensors as a continuous group starting at 0 or place at the very end with no 'normal' sensors after it. Within the matrix list, the rows should be grouped together and the columns should be grouped together. <div class="fragment"><pre class="fragment"> <span class="comment">// Example sensor configuration for matrix</span>
<span class="preprocessor"> #define MTOUCH_SENSOR0              AN0     // Matrix Row0    </span>
<span class="preprocessor"></span><span class="preprocessor"> #define MTOUCH_SENSOR1              AN1     // Matrix Row1</span>
<span class="preprocessor"></span><span class="preprocessor"> #define MTOUCH_SENSOR2              AN2     // Matrix Col0</span>
<span class="preprocessor"></span><span class="preprocessor"> #define MTOUCH_SENSOR3              AN3     // Matrix Col1</span>
<span class="preprocessor"></span><span class="preprocessor"> #define MTOUCH_SENSOR4              AN4     // Matrix Col2</span>
<span class="preprocessor"></span><span class="preprocessor"> #define MTOUCH_SENSOR5              AN5     // Normal mTouch Sensor</span>
<span class="preprocessor"> #define MTOUCH_SENSOR6              AN6     // Normal mTouch Sensor</span>
</pre></div> <div class="fragment"><pre class="fragment"> <span class="comment">// Example sensor configuration for matrix</span>
<span class="preprocessor"> #define MTOUCH_SENSOR0              AN0     // Normal mTouch Sensor</span>
<span class="preprocessor"></span><span class="preprocessor"> #define MTOUCH_SENSOR1              AN1     // Normal mTouch Sensor</span>
<span class="preprocessor"></span><span class="preprocessor"> #define MTOUCH_SENSOR2              AN2     // Matrix Col0</span>
<span class="preprocessor"></span><span class="preprocessor"> #define MTOUCH_SENSOR3              AN3     // Matrix Col1</span>
<span class="preprocessor"></span><span class="preprocessor"> #define MTOUCH_SENSOR4              AN4     // Matrix Col2</span>
<span class="preprocessor"></span><span class="preprocessor"> #define MTOUCH_SENSOR5              AN5     // Matrix Row0</span>
<span class="preprocessor"> #define MTOUCH_SENSOR6              AN6     // Matrix Row1</span>
</pre></div> </li>
<li>
At the bottom of <a class="el" href="m_touch__config_8h.html" title="Framework Configuration! Main configuration file for the mTouch Framework.">mTouch_config.h</a> is the 'Decoding' section which contains the matrix configuration options. <ol type="a">
<li>
Uncomment MTOUCH_MATRIX_ENABLED to enable matrix decoding. </li>
<li>
Define <a class="el" href="group___configuration.html#ga1596671b0217870ada979c7245a9c1a1" title="Defines which MTOUCH_SENSORx sensor is the start-index of the &#39;row&#39; sensors.">MTOUCH_MATRIX_ROW_START</a> and <a class="el" href="group___configuration.html#ga3bb6087fa82a16fcce3af066dff76c53" title="Defines which MTOUCH_SENSORx sensor is the final-index of the &#39;row&#39; sensors.">MTOUCH_MATRIX_ROW_END</a> to the MTOUCH_SENSORx index values for the row sensors. In the first example, above, the start would be '0' and the end would be '1'. In the second example, the start would be '5' and the end would be '6'. </li>
<li>
Define <a class="el" href="group___configuration.html#ga5cf38b75774c4ccee0c86e2020de7c32" title="Defines which MTOUCH_SENSORx sensor is the start-index of the &#39;column&#39; sensors.">MTOUCH_MATRIX_COLUMN_START</a> and <a class="el" href="group___configuration.html#ga24290044992d115cdfef0b2519338889" title="Defines which MTOUCH_SENSORx sensor is the final-index of the &#39;column&#39; sensors.">MTOUCH_MATRIX_COLUMN_END</a> to the MTOUCH_SENSORx index values for the column sensors. In the first example, above, the start would be '2' and the end would be '4'. In the second example, the start would be '2' and the end would be '4'. </li>
<li>
Define one MTOUCH_SENSORx_IS_PROX definition per enabled proximity sensor. The value of the definition must be its 'proximity index' value. The 'Proximity index' is used as the index to proximity variable arrays. In total, the indexes should start at 0 and end with MTOUCH_NUMBER_PROXIMITY - 1. The order is arbitrary. </li>
<li>
If desired, set the value of <a class="el" href="group___configuration.html#ga4d90fdf18567ae9298a47b4c50862756" title="This configuration option determines how much more pressed the most-pressed sensor must be above all ...">MTOUCH_MOST_PRESSED_THRESHOLD</a> to the number of counts that the most-pressed row or column must be greater than the second-most-pressed row/column to qualify it as the 'most pressed'. </li>
</ol>
</li>
</ol>
<h2><a class="anchor" id="featMatrix-Ex"></a>
Example</h2>
<div class="fragment"><pre class="fragment"><span class="preprocessor"> #define MTOUCH_MATRIX_ENABLED               // &lt;-- Matrix decoding is enabled</span>
<span class="preprocessor"></span><span class="preprocessor"> #define MTOUCH_MATRIX_ROW_START         0   // &lt;-- The sensor index of the first row</span>
<span class="preprocessor"></span><span class="preprocessor"> #define MTOUCH_MATRIX_ROW_END           1   // &lt;-- The sensor index of the last row</span>
<span class="preprocessor"></span><span class="preprocessor"> #define MTOUCH_MATRIX_COLUMN_START      2   // &lt;-- The sensor index of the first column</span>
<span class="preprocessor"></span><span class="preprocessor"> #define MTOUCH_MATRIX_COLUMN_END        4   // &lt;-- The sensor index of the last column</span>
<span class="preprocessor"></span><span class="preprocessor"> #define MTOUCH_MOST_PRESSED_THRESHOLD   10  // &lt;-- The most pressed column/row must be at least 10 counts</span>
<span class="preprocessor">                                             //     greater than the second-most-pressed column/row.</span>
</pre></div> <div class="fragment"><pre class="fragment"><span class="preprocessor"> #define MTOUCH_MATRIX_ENABLED               // &lt;-- Matrix decoding is enabled</span>
<span class="preprocessor"></span><span class="preprocessor"> #define MTOUCH_MATRIX_ROW_START         2   // &lt;-- The sensor index of the first row</span>
<span class="preprocessor"></span><span class="preprocessor"> #define MTOUCH_MATRIX_ROW_END           3   // &lt;-- The sensor index of the last row</span>
<span class="preprocessor"></span><span class="preprocessor"> #define MTOUCH_MATRIX_COLUMN_START      4   // &lt;-- The sensor index of the first column</span>
<span class="preprocessor"></span><span class="preprocessor"> #define MTOUCH_MATRIX_COLUMN_END        6   // &lt;-- The sensor index of the last column</span>
<span class="preprocessor"></span><span class="preprocessor"> #define MTOUCH_MOST_PRESSED_THRESHOLD   10  // &lt;-- The most pressed column/row must be at least 10 counts</span>
<span class="preprocessor">                                             //     greater than the second-most-pressed column/row.</span>
</pre></div><h2><a class="anchor" id="featMatrix-Out"></a>
Matrix Output</h2>
<p>The mTouch Framework stores the column and row output coordinates in an 8-bit value to save on RAM requirements. To easily decode which row and column is pressed, use the mTouch_Matrix_getRow() and mTouch_Matrix_getColumn() API functions. They will return the row and column indexes, respectively.</p>
<p>Note: The index they will be returning is relative to the matrix rows and matrix columns - not on the MTOUCH_SENSORx index value. For example, in the two example MTOUCH_SENSORx configurations above, pressing on Row0's sensor will make mTouch_Matrix_getRow() return '0' - regardless of whether the row is defined as MTOUCH_SENSOR0 or MTOUCH_SENSOR5.</p>
<p>mTouch_Matrix_hasChanged() will return a '0' if there was no change in the matrix output value since the last decode. mTouch_Matrix_latchNewValue() will save the current value of the matrix for later comparison. mTouch_Matrix_isPressed() will return a '0' if there are no pressed nodes on the matrix.</p>
<h2><a class="anchor" id="featMatrix-API"></a>
Example Matrix API</h2>
<div class="fragment"><pre class="fragment"> <span class="keywordflow">if</span> (mTouch_Matrix_hasChanged())         <span class="comment">// If the matrix value has changed since last time</span>
 {
     mTouch_Matrix_latchNewValue();      <span class="comment">// Save the new value of the matrix</span>
     
     LED1  = LED_OFF;                    <span class="comment">// Reset all matrix outputs</span>
     LED2  = LED_OFF;
     LED3  = LED_OFF;
     LED4  = LED_OFF;
     LED5  = LED_OFF;
     LED6  = LED_OFF;
     LED7  = LED_OFF;
     LED8  = LED_OFF;
     LED9  = LED_OFF;
     LED10 = LED_OFF;
     LED11 = LED_OFF;
     LED12 = LED_OFF;
 }
 
 <span class="keywordflow">if</span> (mTouch_Matrix_isPressed())          <span class="comment">// If the matrix is being pressed</span>
 {
     <span class="keywordflow">switch</span>(mTouch_Matrix_getRow())      <span class="comment">// Find the row/column being pressed and output accordingly.</span>
     {
         <span class="keywordflow">case</span> 0:                         
             <span class="keywordflow">switch</span>(mTouch_Matrix_getColumn())
             {
                 <span class="keywordflow">case</span> 0: LED1  = LED_ON; <span class="keywordflow">break</span>;  <span class="comment">// (0, 0)</span>
                 <span class="keywordflow">case</span> 1: LED2  = LED_ON; <span class="keywordflow">break</span>;  <span class="comment">// (0, 1)</span>
                 <span class="keywordflow">case</span> 2: LED3  = LED_ON; <span class="keywordflow">break</span>;  <span class="comment">// (0, 2)</span>
                 <span class="keywordflow">case</span> 3: LED4  = LED_ON; <span class="keywordflow">break</span>;  <span class="comment">// (0, 3)</span>
             }
             <span class="keywordflow">break</span>;
         <span class="keywordflow">case</span> 1:
             <span class="keywordflow">switch</span>(mTouch_Matrix_getColumn())
             {
                 <span class="keywordflow">case</span> 0: LED5  = LED_ON; <span class="keywordflow">break</span>;  <span class="comment">// (1, 0)</span>
                 <span class="keywordflow">case</span> 1: LED6  = LED_ON; <span class="keywordflow">break</span>;  <span class="comment">// (1, 1)</span>
                 <span class="keywordflow">case</span> 2: LED7  = LED_ON; <span class="keywordflow">break</span>;  <span class="comment">// (1, 2)</span>
                 <span class="keywordflow">case</span> 3: LED8  = LED_ON; <span class="keywordflow">break</span>;  <span class="comment">// (1, 3)</span>
             }
             <span class="keywordflow">break</span>;
         <span class="keywordflow">case</span> 2:
             <span class="keywordflow">switch</span>(mTouch_Matrix_getColumn())
             {
                 <span class="keywordflow">case</span> 0: LED9  = LED_ON; <span class="keywordflow">break</span>;  <span class="comment">// (2, 0)</span>
                 <span class="keywordflow">case</span> 1: LED10 = LED_ON; <span class="keywordflow">break</span>;  <span class="comment">// (2, 1)</span>
                 <span class="keywordflow">case</span> 2: LED11 = LED_ON; <span class="keywordflow">break</span>;  <span class="comment">// (2, 2)</span>
                 <span class="keywordflow">case</span> 3: LED12 = LED_ON; <span class="keywordflow">break</span>;  <span class="comment">// (2, 3)</span>
             }
             <span class="keywordflow">break</span>;
     }
 }
</pre></div> </div>
<hr class="footer"/><address class="footer"><small>mTouch Framework v2.1 documentation by&#160;
<a href="http://www.microchip.com"> 
<img class="footer" src="../includes/mchp.jpeg" alt="Click here to visit our website at www.microchip.com"/></a></small></address> 
</body> 
</html> 
